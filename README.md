# tcpdump 介绍

tcpdump 是世界上首屈一指的网络分析工具，将强大的功能和简单性结合到一个命令行界面中。

如何过滤流量，包括 IP、端口、协议、应用程序等

## 选项

-a：尝试将网络和广播地址转换成名称；  
-c<数据包数目>：收到指定的数据包数目后，就停止进行倾倒操作；  
-d：把编译过的数据包编码转换成可阅读的格式，并倾倒到标准输出；  
-dd：把编译过的数据包编码转换成C语言的格式，并倾倒到标准输出；  
-ddd：把编译过的数据包编码转换成十进制数字的格式，并倾倒到标准输出；  
-e：在每列倾倒资料上显示连接层级的文件头；  
-f：用数字显示网际网络地址；  
-F<表达文件>：指定内含表达方式的文件；  
-i<网络界面>：使用指定的网络截面送出数据包；  
-l：使用标准输出列的缓冲区；  
-n：不把主机的网络地址转换成名字；  
-N：不列出域名；  
-O：不将数据包编码最佳化；  
-p：不让网络界面进入混杂模式；  
-q ：快速输出，仅列出少数的传输协议信息；  
-r<数据包文件>：从指定的文件读取数据包数据；  
-s<数据包大小>：设置每个数据包的大小；  
-S：用绝对而非相对数值列出TCP关联数；  
-t：在每列倾倒资料上不显示时间戳记；  
-tt： 在每列倾倒资料上显示未经格式化的时间戳记；  
-T<数据包类型>：强制将表达方式所指定的数据包转译成设置的数据包类型；  
-v：详细显示指令执行过程；  
-vv：更详细显示指令执行过程；  
-x：用十六进制字码列出数据包资料；  
-w：<数据包文件>：把数据包数据写入指定的文件。  

## 流量过滤示例

### 查看网卡上的网络流量

```bash
tcpdump -i eth0
```

### 过滤特定 IP

```bash
tcpdump ip host 192.168.1.1
```

### 过滤来源或目的IP地址

方向为 src 和 dst  

```bash
tcpdump src 192.168.1.1
```

### 按网络查找数据包

```bash
tcpdump net 192.168.1.0/24
```

### 协议过滤

ICMP IGMP IGRP IP IP6 TCP UDP RIP RARP SCCP

```bash
tcpdump icmp
```

### 特定端口过滤

```bash
tcpdump port 80
tcpdump port 80-85
tcpdump dst port 80
```

### 数据包大小过滤

```bash
tcpdump 'len > 32 and len < 64'
```

### 读取/写入到文件

```bash
tcpdump -w output.pcap -i eth0
tcpdump -r input.pcap
```